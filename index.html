<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Demo Trading Pro - Advanced Mode</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<style>
body{margin:0;font-family:Arial;background:#0f172a;color:white;text-align:center}
header{background:#020617;padding:14px;font-weight:bold}
.balance{padding:8px;font-size:15px;color:#22c55e}
.price{font-size:20px;margin:6px}
select{padding:6px;margin:5px;border-radius:5px}
canvas{background:#111827;margin-top:10px;border-radius:6px}
.timer{font-size:14px;margin:5px;color:#facc15}
button{padding:8px 12px;margin:4px;border:none;border-radius:6px;color:white;cursor:pointer}
.buy{background:#16a34a}
.sell{background:#dc2626}
.message{margin-top:6px;font-size:14px}
.profit{color:#22c55e}
.loss{color:#ef4444}
.history{margin-top:8px;padding:6px;background:#020617;font-size:12px}
.tradeItem{margin:2px 0}
</style>
</head>

<body>

<header>ðŸ“Š DEMO TRADING PRO - INDEX MODE</header>

<div class="balance" id="balance">Demo Balance: â‚¹10000</div>

<select id="indexSelect" onchange="changeIndex()">
<option value="nifty">NIFTY</option>
<option value="banknifty">BANKNIFTY</option>
<option value="crude">CRUDE OIL</option>
</select>

<div class="price" id="price">â‚¹100.00</div>

<canvas id="chart" width="350" height="200"></canvas>

<div class="timer" id="timer"></div>

<button class="buy" onclick="startTrade('BUY')">BUY</button>
<button class="sell" onclick="startTrade('SELL')">SELL</button>

<div id="message" class="message">Market Running...</div>

<div class="history">
<h3>Last Trades</h3>
<div id="tradeHistory"></div>
</div>

<script>
let balance=10000;
let price=100;
let volatility=2;
let candles=[];
let trades=[];
let currentTrade=null;
let countdownInterval=null;

const canvas=document.getElementById("chart");
const ctx=canvas.getContext("2d");

function changeIndex(){
 let index=document.getElementById("indexSelect").value;

 if(index==="nifty"){
  price=18000;
  volatility=10;
 }
 if(index==="banknifty"){
  price=42000;
  volatility=20;
 }
 if(index==="crude"){
  price=6000;
  volatility=15;
 }

 candles=[];
 document.getElementById("message").innerText="Switched to "+index.toUpperCase();
}

function drawCandles(){
 ctx.clearRect(0,0,canvas.width,canvas.height);
 if(candles.length<2) return;

 let max=Math.max(...candles.map(c=>c.high));
 let min=Math.min(...candles.map(c=>c.low));
 let range=max-min;

 candles.forEach((c,i)=>{
   let x=i*12+10;
   let openY=canvas.height-((c.open-min)/range)*canvas.height;
   let closeY=canvas.height-((c.close-min)/range)*canvas.height;
   let highY=canvas.height-((c.high-min)/range)*canvas.height;
   let lowY=canvas.height-((c.low-min)/range)*canvas.height;

   ctx.strokeStyle=c.close>=c.open?"#22c55e":"#ef4444";
   ctx.fillStyle=ctx.strokeStyle;

   ctx.beginPath();
   ctx.moveTo(x+3,highY);
   ctx.lineTo(x+3,lowY);
   ctx.stroke();

   ctx.fillRect(x,Math.min(openY,closeY),6,Math.abs(closeY-openY)||2);
 });
}

setInterval(()=>{
 let open=price;
 price+=(Math.random()-0.5)*volatility;
 if(price<1) price=1;
 let close=price;
 let high=Math.max(open,close)+Math.random()*volatility;
 let low=Math.min(open,close)-Math.random()*volatility;

 candles.push({open,close,high,low});
 if(candles.length>25) candles.shift();

 document.getElementById("price").innerText="â‚¹"+price.toFixed(2);

 drawCandles();
 checkSLTarget();
},1000);

function startTrade(type){
 if(currentTrade){
  document.getElementById("message").innerText="Trade running...";
  return;
 }

 currentTrade={
  type:type,
  entry:price,
  sl:type==="BUY"?price-volatility:price+volatility,
  target:type==="BUY"?price+volatility:price-volatility
 };

 document.getElementById("message").innerText=
 type+" @ â‚¹"+price.toFixed(2)+" | SL â‚¹"+currentTrade.sl.toFixed(2)+" | Target â‚¹"+currentTrade.target.toFixed(2);

 startTimer(5);
}

function startTimer(sec){
 let t=sec;
 document.getElementById("timer").innerText="Time: "+t+"s";

 countdownInterval=setInterval(()=>{
  t--;
  document.getElementById("timer").innerText="Time: "+t+"s";
  if(t<=0){
   clearInterval(countdownInterval);
   closeTrade("TIME");
  }
 },1000);
}

function checkSLTarget(){
 if(!currentTrade) return;

 if(currentTrade.type==="BUY"){
  if(price<=currentTrade.sl){clearInterval(countdownInterval);closeTrade("SL");}
  if(price>=currentTrade.target){clearInterval(countdownInterval);closeTrade("TARGET");}
 }

 if(currentTrade.type==="SELL"){
  if(price>=currentTrade.sl){clearInterval(countdownInterval);closeTrade("SL");}
  if(price<=currentTrade.target){clearInterval(countdownInterval);closeTrade("TARGET");}
 }
}

function closeTrade(reason){
 if(!currentTrade) return;

 let pnl=currentTrade.type==="BUY"?(price-currentTrade.entry):(currentTrade.entry-price);
 pnl=Math.round(pnl);
 balance+=pnl;

 let text=currentTrade.type+" "+(pnl>=0?"WIN +":"LOSS ")+"â‚¹"+Math.abs(pnl)+" ("+reason+")";

 document.getElementById("message").innerText=text;
 document.getElementById("message").className="message "+(pnl>=0?"profit":"loss");

 trades.unshift(text);
 if(trades.length>5) trades.pop();
 updateHistory();
 updateBalance();

 document.getElementById("timer").innerText="";
 currentTrade=null;
}

function updateBalance(){
 document.getElementById("balance").innerText="Demo Balance: â‚¹"+balance;
}

function updateHistory(){
 let html="";
 trades.forEach(t=>{html+="<div class='tradeItem'>"+t+"</div>";});
 document.getElementById("tradeHistory").innerHTML=html;
}
</script>

</body>
</html>
